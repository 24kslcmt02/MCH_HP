name: Deploy to Sakura Server

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ğŸšš Get latest code
        uses: actions/checkout@v4

      # Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆã“ã‚ŒãŒãªã„ã¨npmã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã¾ã›ã‚“ï¼‰
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
      - name: ğŸ”¨ Build Project
        run: |
          npm ci
          npm run build

      # FTPã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      - name: ğŸ“‚ Sync files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftp
          port: 21
          security: loose
          # â†“â†“â†“ ã“ã“ã‚’ã‚ãªãŸã®ã‚µãƒ¼ãƒãƒ¼è¨­å®šã«åˆã‚ã›ã¦ä¿®æ­£ã—ã¾ã—ãŸ â†“â†“â†“
          server-dir: ./www/ms-capital/
          # ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¥ã£ã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®š
          local-dir: ./dist/
          dry-run: false
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
